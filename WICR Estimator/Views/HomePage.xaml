<UserControl x:Class="WICR_Estimator.Views.HomePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
      xmlns:local="clr-namespace:WICR_Estimator.Views"
      xmlns:conv="clr-namespace:WICR_Estimator.Converters"
      xmlns:ei="http://schemas.microsoft.com/expression/2010/interactions"
      mc:Ignorable="d" d:DesignWidth="1050" d:DesignHeight="800"
      >
    <UserControl.Resources>
        <conv:BoolToVisibilityConverter x:Key="VisibilityConv"/>
        <DataTemplate x:Key="ProjectTemplate">
            <StackPanel Orientation="Horizontal" Background="#00C0E0FF">
                <Image x:Name="tickImage" Source="..\Images\tick.png"
                       Height="25" HorizontalAlignment="Right"
                      Visibility="{Binding IsSelectedProject,
                    Converter={StaticResource VisibilityConv}}"/>
                <TextBlock Text="{Binding Path=Name}"
                           FontWeight="SemiBold"
                           FontSize="15" />
                
            </StackPanel>
            <!--<DataTemplate.Triggers>
                <DataTrigger
                Binding="{Binding
                    RelativeSource={RelativeSource
                        Mode=FindAncestor,
                        AncestorType={x:Type ListBoxItem}},
                        Path=IsSelected}"
                Value="True">
                    <Setter TargetName="tickImage"
                Property="Visibility"
                Value="Visible"/>
                </DataTrigger>
            </DataTemplate.Triggers>-->
        </DataTemplate>
        <Style x:Key="ButtonTemplate" TargetType="Button">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="Height" Value="35"/>
            <Setter Property="Width" Value="170"/>
        </Style>
                
        <Style x:Key="ContainerStyle" TargetType="{x:Type GroupItem}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate>
                        <Expander IsExpanded="True" Margin="10,5,0,0">
                            <Expander.Header>
                                <TextBlock Text="{Binding Name}"
                                           VerticalAlignment="Bottom">
                                    <TextBlock.Style>
                                        <Style>
                                            <Setter Property="TextBlock.FontWeight" Value="Bold"/>
                                            <Setter Property="TextBlock.FontSize" Value="16"/>
                                            <Setter Property="TextBlock.Foreground" Value="Gray"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Name}" Value="Deck Coatings">
                                                    <Setter Property="TextBlock.FontWeight" Value="Bold"/>
                                                    <Setter Property="TextBlock.FontSize" Value="18"/>
                                                    <Setter Property="TextBlock.Foreground" Value="Blue"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Name}" Value="Concrete On Grade">
                                                    <Setter Property="TextBlock.FontWeight" Value="Bold"/>
                                                    <Setter Property="TextBlock.FontSize" Value="18"/>
                                                    <Setter Property="TextBlock.Foreground" Value="Blue"/>
                                                </DataTrigger>
                                            </Style.Triggers> 
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </Expander.Header>
                            <ItemsPresenter />
                        </Expander>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width=".75*"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width=".65*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <StackPanel Background="AntiqueWhite">
            <TextBlock Text="Projects for Estimates"
                   FontSize="16"
                   Margin="5,5,0,5"
                   FontWeight="Bold"/>
        </StackPanel>

        <ListView HorizontalContentAlignment="Stretch" 
                 Grid.Row="1"
                 BorderBrush="Black"
                 BorderThickness="2,2,2,0"
                 Background="AliceBlue"
                 x:Name="ProjectList"
                 SelectionMode="Multiple"
                 ItemsSource="{Binding ProjectView}"
                 
                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                 ItemTemplate="{StaticResource ProjectTemplate}">
                 <!--<i:Interaction.Triggers>
                    <i:EventTrigger EventName="SelectionChanged">
                        <ei:ChangePropertyAction 
                            TargetObject="{Binding Mode=OneWay}"
                            PropertyName="SelectedItems"
                            Value="{Binding Path=SelectedItems, 
                            ElementName=ProjectList}"/>
                    </i:EventTrigger>
                </i:Interaction.Triggers>-->
            <ListView.GroupStyle>
                <GroupStyle ContainerStyle="{StaticResource ContainerStyle}"/>
            </ListView.GroupStyle>
            
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Foreground" Value="Blue"/>
                        </Trigger>
                    </Style.Triggers>
                    <Setter Property="IsSelected" Value="{Binding IsSelectedProject}" />
                </Style>
            </ListView.ItemContainerStyle>
            
        </ListView>
        
        <DataGrid ItemsSource="{Binding SelectedProjects,UpdateSourceTrigger=PropertyChanged}"
                  FontSize="14"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Top"
                  Grid.RowSpan="2"
                  IsReadOnly="True"
                  CanUserAddRows="False"
                  AutoGenerateColumns="False"
                  Margin="10,2,10,0"
                  Grid.Column="1">
            <DataGrid.Columns >
                <DataGridTextColumn Header="Name" IsReadOnly="True"
                                    Binding="{Binding Name}"/>
                <DataGridTextColumn Header="Metal Cost" 
                                    Binding="{Binding MetalCost,StringFormat='c'}"/>
                <DataGridTextColumn Header ="Slope Cost"
                                    Binding="{Binding SlopeCost,StringFormat='c'}"
                                    IsReadOnly="False"/>
                <DataGridTextColumn Header ="System Cost"
                                    Binding="{Binding SystemNOther,StringFormat='c'}"
                                    IsReadOnly="False"/>
                <DataGridTextColumn Header ="Material Cost" 
                                    Binding="{Binding MaterialCost,StringFormat='c'}"
                                    IsReadOnly="False"/>
                <DataGridTextColumn Header ="Labor Cost" 
                                    Binding="{Binding LaborCost,StringFormat='c'}"
                                    IsReadOnly="False"/>
                
                <DataGridTextColumn Header ="Labor %" 
                                    Binding="{Binding LaborPercentage}"
                                    IsReadOnly="False"/>
                <DataGridTextColumn Header ="Total Cost" 
                                    Binding="{Binding TotalCost,StringFormat='c'}"
                                    IsReadOnly="False"/>
                <!--<DataGridTextColumn Header ="Sub Contract Cost" 
                                    Binding="{Binding SubContractCost}"
                                    IsReadOnly="False"/>-->
            </DataGrid.Columns>
            <!--<i:Interaction.Triggers>
                <i:EventTrigger EventName="SelectionChanged">
                    <i:InvokeCommandAction Command="{Binding ChangePageCommand}" 
                            CommandParameter="{Binding Path=SelectedItem,
                        RelativeSource={RelativeSource Mode=FindAncestor,
                        AncestorType=DataGrid}}" />
                </i:EventTrigger>
            </i:Interaction.Triggers>-->
        </DataGrid>
        <StackPanel Grid.Column="2"
                    Grid.RowSpan="2">
            <TextBlock Text="Project Name" 
                       FontSize="14"
                       Margin="5,5,5,0"/>
            <TextBox Margin="5,0,5,0"
                     FontSize="14"/>
            <TextBlock Text="Prepared By" Margin="5,5,5,0"
                       FontSize="14"/>
            <TextBox Margin="5,0,5,10"
                     FontSize="14"/>
            <DatePicker Margin="5" Height="30"
                        FontSize="14"
                        VerticalContentAlignment="Center"
                        HorizontalContentAlignment="Left"/>
            <Button Content="Load Estimate" Margin="5" 
                    Command="{Binding LoadEstimate}"
                    Style="{StaticResource ButtonTemplate}"/>
            <Button Content="Save Estimate" 
                    Command="{Binding SaveEstimate}"
                    Style="{StaticResource ButtonTemplate}"/>
            <Button Content="Create Estimate"
                    Style="{StaticResource ButtonTemplate}"/>
            <Button Content="Create Summary Sheet"
                    Style="{StaticResource ButtonTemplate}"/>
            <Button Content="Refresh Google Data"
                    x:Name="refreshGData"
                    Click="refreshGData_Click"
                    Style="{StaticResource ButtonTemplate}"/>
            <CheckBox Content="Login As Admin"
                          Margin="10" x:Name="cbpasswordSection"
                          Foreground="#FF2A6DCD"
                          IsChecked="{Binding ShowLogin}">
            </CheckBox>
            <TextBlock Text="{Binding LoginMessage}"
                           Margin="10,0,0,0" Foreground="Red"/>
            <StackPanel Visibility="{Binding HidePasswordSection}">
                <TextBlock Margin="10,0,0,0" Text="Enter Password"
                               Foreground="#FF2A6DCD"/>
                <PasswordBox x:Name="passwordbox" Margin="10" Width="140"
                                 HorizontalAlignment="Left"/>
                <Button HorizontalAlignment="Left" Content="OK"
                            Margin="10,0,0,0"
                            Command="{Binding ShowCalculationDetails}" 
                            CommandParameter="{Binding ElementName=passwordbox}"/>
            </StackPanel>
        </StackPanel>
    </Grid>
</UserControl>
