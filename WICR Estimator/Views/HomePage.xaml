<UserControl x:Class="WICR_Estimator.Views.HomePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
      xmlns:local="clr-namespace:WICR_Estimator.Views"
      xmlns:conv="clr-namespace:WICR_Estimator.Converters"
      xmlns:System="clr-namespace:System;assembly=mscorlib"
      xmlns:ei="http://schemas.microsoft.com/expression/2010/interactions"
      mc:Ignorable="d" d:DesignWidth="1550" d:DesignHeight="800"
      xmlns:behaviors="clr-namespace:WICR_Estimator"
           Loaded="UserControl_Loaded"    
      >
    <UserControl.Resources>
        <conv:BoolToVisibilityConverter x:Key="VisibilityConv"/>
        <DataTemplate x:Key="ProjectTemplate">
            <DockPanel VerticalAlignment="Center"
                        >
                <Image x:Name="tickImage" Source="..\Images\tick.png"
                       Height="25" HorizontalAlignment="Right"
                       VerticalAlignment="Center"
                      Visibility="{Binding IsSelectedProject,
                    Converter={StaticResource VisibilityConv}}"/>
                <TextBlock Text="{Binding Path=Name}"
                           FontWeight="SemiBold"
                           VerticalAlignment="Center"
                           FontSize="15" />
                <Button FontFamily="Segoe MDL2 Assets"                       
                        FontSize="12"                        
                        BorderThickness="0"
                        Width="20"
                        Height="20"
                        Command="{Binding RelativeSource={RelativeSource FindAncestor, 
AncestorType={x:Type UserControl}}, Path=DataContext.ReplicateProject}"
                        CommandParameter="{Binding}"
                        VerticalAlignment="Center"
                        Margin="0,0,10,0"
                        HorizontalAlignment="Right"
                        Content="&#xE8C8;"/>
                <!--<Button FontFamily="Segoe MDL2 Assets"                       
                        FontSize="12"                        
                        BorderThickness="0"
                        Width="20"
                        Height="20"
                        Command="{Binding RelativeSource={RelativeSource FindAncestor, 
AncestorType={x:Type UserControl}}, Path=DataContext.ReplicateIndependentProject}"
                        CommandParameter="{Binding}"
                        VerticalAlignment="Center"
                        Margin="0,0,10,0"
                        HorizontalAlignment="Right"
                        Content="&#xE74C;"/>-->
            </DockPanel>
            <!--<DataTemplate.Triggers>
                <DataTrigger
                Binding="{Binding
                    RelativeSource={RelativeSource
                        Mode=FindAncestor,
                        AncestorType={x:Type ListBoxItem}},
                        Path=IsSelected}"
                Value="True">
                    <Setter TargetName="tickImage"
                Property="Visibility"
                Value="Visible"/>
                </DataTrigger>
            </DataTemplate.Triggers>-->
        </DataTemplate>
        <Style x:Key="ButtonTemplate" TargetType="Button">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="Height" Value="35"/>
            <Setter Property="Width" Value="170"/>
        </Style>
                
        <Style x:Key="ContainerStyle" TargetType="{x:Type GroupItem}">
            <Setter Property="Template">
                <Setter.Value>
                     <ControlTemplate>
                        <Expander Margin="10,5,0,0" IsExpanded="{Binding Mode=TwoWay,
                                  UpdateSourceTrigger=Explicit,RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Expander},AncestorLevel=1}, Path=IsExpanded}">
                            <!--<i:Interaction.Behaviors>
                                <behaviors:PersistGroupExpandedStateBehavior GroupName="{Binding Name}" />
                            </i:Interaction.Behaviors>-->
                            <Expander.Header>
                                <TextBlock Text="{Binding Name}"
                                           VerticalAlignment="Bottom">
                                    <TextBlock.Style>
                                        <Style>
                                            <Setter Property="TextBlock.FontWeight" Value="Bold"/>
                                            <Setter Property="TextBlock.FontSize" Value="16"/>
                                            <Setter Property="TextBlock.Foreground" Value="Gray"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Name}" Value="Deck Coatings">
                                                    <Setter Property="TextBlock.FontWeight" Value="Bold"/>
                                                    <Setter Property="TextBlock.FontSize" Value="18"/>
                                                    <!--<Setter Property="TextBlock.Foreground" Value="BurlyWood"/>-->
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Name}" Value="Concrete On Grade">
                                                    <Setter Property="TextBlock.FontWeight" Value="Bold"/>
                                                    <Setter Property="TextBlock.FontSize" Value="18"/>
                                                    <!--<Setter Property="TextBlock.Foreground" Value="BurlyWood"/>-->
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Name}" Value="Below Grade">
                                                    <Setter Property="TextBlock.FontWeight" Value="Bold"/>
                                                    <Setter Property="TextBlock.FontSize" Value="18"/>
                                                    <!--<Setter Property="TextBlock.Foreground" Value="BurlyWood"/>-->
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Name}" Value="Replicated Projects">
                                                    <Setter Property="TextBlock.FontWeight" Value="Bold"/>
                                                    <Setter Property="TextBlock.FontSize" Value="18"/>
                                                    <!--<Setter Property="TextBlock.Foreground" Value="BurlyWood"/>-->
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Name}" Value="Below Tile">
                                                    <Setter Property="TextBlock.FontWeight" Value="Bold"/>
                                                    <Setter Property="TextBlock.FontSize" Value="18"/>
                                                    <!--<Setter Property="TextBlock.Foreground" Value="BurlyWood"/>-->
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Name}" Value="Epoxy Coatings">
                                                    <Setter Property="TextBlock.FontWeight" Value="Bold"/>
                                                    <Setter Property="TextBlock.FontSize" Value="18"/>
                                                    <!--<Setter Property="TextBlock.Foreground" Value="BurlyWood"/>-->
                                                </DataTrigger>
                                            </Style.Triggers> 
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </Expander.Header>
                            <ItemsPresenter />
                        </Expander>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>
    <Grid>
        
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width=".75*"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width=".65*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <StackPanel >
            <TextBlock Text="Projects for Estimates"
                       
                   FontSize="16"
                   Margin="5,5,0,5"
                   FontWeight="Bold"/>
            <TextBox Margin="5,0,5,5" 
                     FontWeight="SemiBold"  
                     x:Name="FilterTextBox"
                     TextChanged="FilterTextBox_TextChanged"
                     Text="{Binding FilterString,UpdateSourceTrigger=PropertyChanged}"
                     FontSize="14"></TextBox>
        </StackPanel>

        <ListView HorizontalContentAlignment="Stretch" 
                 Grid.Row="1"
                 BorderBrush="Black"
                 BorderThickness="2,2,2,0"
                 Background="#DDEBF7"
                 x:Name="ProjectList"
                 SelectionMode="Multiple"
                 ItemsSource="{Binding ProjectView}"
                 ScrollViewer.HorizontalScrollBarVisibility="Auto"
                 ItemTemplate="{StaticResource ProjectTemplate}">
                 <!--<i:Interaction.Triggers>
                    <i:EventTrigger EventName="SelectionChanged">
                        <ei:ChangePropertyAction 
                            TargetObject="{Binding Mode=OneWay}"
                            PropertyName="SelectedItems"
                            Value="{Binding Path=SelectedItems, 
                            ElementName=ProjectList}"/>
                    </i:EventTrigger>
                </i:Interaction.Triggers>-->
            <ListView.GroupStyle>
                <GroupStyle ContainerStyle="{StaticResource ContainerStyle}"/>
            </ListView.GroupStyle>
            
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Style.Triggers>
                        <MultiTrigger>
                            <MultiTrigger.Conditions>
                                <Condition Property="IsSelected" Value="True" />
                            </MultiTrigger.Conditions>
                            <MultiTrigger.Setters>
                                <Setter Property="Background" Value="#1F4E78" />
                                <Setter Property="BorderBrush" Value="#1F4E78" />
                                <Setter Property="Foreground" Value="White"/>
                            </MultiTrigger.Setters>
                        </MultiTrigger>
                    </Style.Triggers>
                    <Setter Property="IsSelected" Value="{Binding IsSelectedProject}" />
                </Style>
            </ListView.ItemContainerStyle>
            
        </ListView>
        <Grid Grid.RowSpan="2" Grid.Column="1">
            <Popup  HorizontalAlignment="Stretch"
                   IsOpen="{Binding IsProcessing}"
                   Height="100"
                   
                    AllowsTransparency="True"
                Placement="Center"
                    Width="500"
                   VerticalAlignment="Top">
                <StackPanel Background="LightBlue">
                    <TextBlock Background="LightBlue" FontSize="15"
                               Margin="10"                              
                           Text="{Binding StatusMessage}">

                    </TextBlock>
                    <ProgressBar  Height="10" Margin="10"
                        Minimum="1" Maximum="27" Value="{Binding CompletedProjects}" />
                </StackPanel>

            </Popup>
            <DataGrid ItemsSource="{Binding SelectedProjects,UpdateSourceTrigger=PropertyChanged}"
                  FontSize="14"
                  VerticalAlignment="Top"
                  HorizontalAlignment="Stretch"                  
                  IsReadOnly="True"
                  CanUserAddRows="False"
                  AutoGenerateColumns="False"
                  Background="#BFBFBF"
                  Margin="10,2,10,0"
                  >
                <DataGrid.Resources>
                    <!--<Style BasedOn="{StaticResource {x:Type DataGridColumnHeader}}" TargetType="{x:Type DataGridColumnHeader}">
                        <Setter Property="Background" Value="#BFBFBF" />
                    </Style>-->
                    <Style BasedOn="{StaticResource {x:Type DataGridRow}}" TargetType="{x:Type DataGridRow}">
                        <Setter Property="Background" Value="#E2EFDA" />
                    </Style>
                </DataGrid.Resources>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Name" IsReadOnly="True"
                                    Binding="{Binding Name}">
                        
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="Work Area" IsReadOnly="True"
                                    Binding="{Binding WorkArea}">
                       
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="Metal Cost" 
                                    Binding="{Binding MetalCost,StringFormat='c'}"/>
                    <DataGridTextColumn Header ="Slope Cost"
                                    Binding="{Binding SlopeCost,StringFormat='c'}"
                                    IsReadOnly="False"/>
                    <DataGridTextColumn Header ="System Cost"
                                    Binding="{Binding SystemNOther,StringFormat='c'}"
                                    IsReadOnly="False"/>
                    <DataGridTextColumn Header ="Material Cost" 
                                    Binding="{Binding MaterialCost,StringFormat='c'}"
                                    IsReadOnly="False"/>
                    <DataGridTextColumn Header ="Labor Cost" 
                                    Binding="{Binding LaborCost,StringFormat='c'}"
                                    IsReadOnly="False"/>

                    <DataGridTextColumn Header ="Labor %" 
                                    Binding="{Binding LaborPercentage}"
                                    IsReadOnly="False"/>
                    <DataGridTextColumn Header ="Total Cost" 
                                    Binding="{Binding TotalCost,StringFormat='c'}"
                                    IsReadOnly="False"/>
                    <DataGridTextColumn Header ="Total Cost per SQFT" 
                                    Binding="{Binding CostPerSqFoot,StringFormat='c'}"
                                    IsReadOnly="False"/>
                </DataGrid.Columns>
                <!--<i:Interaction.Triggers>
                <i:EventTrigger EventName="SelectionChanged">
                    <i:InvokeCommandAction Command="{Binding ChangePageCommand}" 
                            CommandParameter="{Binding Path=SelectedItem,
                        RelativeSource={RelativeSource Mode=FindAncestor,
                        AncestorType=DataGrid}}" />
                </i:EventTrigger>
            </i:Interaction.Triggers>-->
            </DataGrid>
            
        </Grid>
        
        <StackPanel Grid.Column="2"
                    Grid.RowSpan="2">
            <TextBlock Text="Job Name" 
                       FontSize="14"
                       Margin="5,5,5,0"/>
            <TextBox Margin="5,0,5,0"
                     Text="{Binding JobName}"
                     FontSize="14"/>
            <TextBlock Text="Prepared By"
                       
                       Margin="5,5,5,0"
                       FontSize="14"/>
            <TextBox Margin="5,0,5,10"
                     Text="{Binding PreparedBy}"
                     FontSize="14"/>
            <DatePicker Margin="5" Height="30"
                        FontSize="14"
                        SelectedDate="{Binding JobCreationDate, Mode=TwoWay,
                        UpdateSourceTrigger=PropertyChanged,
                        TargetNullValue={x:Static System:DateTime.Now}}"
                        VerticalContentAlignment="Center"
                        HorizontalContentAlignment="Left"/>
            <Button Content="Load Estimate" Margin="5" 
                    Command="{Binding LoadEstimate}"
                    Style="{StaticResource ButtonTemplate}"/>
            <Button Content="Save Estimate" 
                    Command="{Binding SaveEstimate}"
                    Style="{StaticResource ButtonTemplate}"/>
            <Button Content="Refresh"
                    Command="{Binding ClearProjects}"
                    Style="{StaticResource ButtonTemplate}"/>
            <Button Content="Create Summary Sheet"
                    Command="{Binding CreateSummary}"
                    Style="{StaticResource ButtonTemplate}"/>
            <Button Content="Refresh Google Data"
                    x:Name="refreshGData"
                    Command="{Binding RefreshGoogleData}"
                    Style="{StaticResource ButtonTemplate}"/>
            <CheckBox Content="Apply Latest Google Price"
                      ToolTip="Please check if you want to apply the latest prices. To revert to old price reload the estimate file."
                      Margin="10,2,0,0"
                      x:Name="applynewPrice"
                      FontSize="15"
                      IsChecked="{Binding ApplyLatestPrice}"
                      IsEnabled="{Binding CanApplyLatestPrice}"
                      />
            <TextBlock Text="Latest Prices have been applied.To revert to old price reload the estimate"
                       Margin="10,0,0,0"
                       Background="Aqua"
                       Foreground="Blue"
                       TextWrapping="Wrap">
                <TextBlock.Style>
                    <Style TargetType="{x:Type TextBlock}">
                <Setter Property="Visibility" Value="Hidden"/>
                <Style.Triggers>
                            <DataTrigger Binding="{Binding ElementName=applynewPrice, Path=IsChecked}"
                                         Value="True">
                        <Setter Property="Visibility" Value="Visible"/>
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </TextBlock.Style>
            </TextBlock>
            <CheckBox Content="Login As Admin"
                          Margin="10,0,10,10" x:Name="cbpasswordSection"
                          Foreground="#FF2A6DCD"
                          IsChecked="{Binding ShowLogin}">
            </CheckBox>
            <TextBlock Text="{Binding LoginMessage}"
                           Margin="10,0,0,0" Foreground="Red"/>
            <StackPanel Visibility="{Binding HidePasswordSection}">
                <TextBlock Margin="10,0,0,0" Text="Enter Password"
                               Foreground="#FF2A6DCD"/>
                <PasswordBox x:Name="passwordbox" Margin="10,0,10,10" Width="140"
                                 HorizontalAlignment="Left"/>
                <Button HorizontalAlignment="Left" Content="OK"
                            Margin="10,0,0,0"
                            Command="{Binding ShowCalculationDetails}" 
                            CommandParameter="{Binding ElementName=passwordbox}"/>
            </StackPanel>
            <GroupBox Header="TOTALS"
                      FontSize="15"
                      Margin="5,5,5,5"
                      VerticalAlignment="Center"
                      Background="#DDEBF7"
                      BorderBrush="Black"
                      FontWeight="Bold"
                      BorderThickness="2">
                <Grid DataContext="{Binding ProjectTotals,UpdateSourceTrigger=PropertyChanged}"
                  HorizontalAlignment="Stretch"
                  Background="#DDEBF7"
                  Grid.Row="1"    
                  Margin="10,0,10,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel>
                        <TextBlock FontSize="13" Margin="0,0,5,5" 
                                   FontWeight="SemiBold" Text="Metal Cost"/>
                        <TextBlock FontSize="13" FontWeight="SemiBold"
                                    Margin="0,0,5,5" Text="Slope Cost"/>
                        <TextBlock FontSize="13"   Margin="0,0,5,5"
                                   FontWeight="SemiBold" Text="System Cost"/>
                        <TextBlock FontSize="13"  Margin="0,0,5,5"
                                   FontWeight="SemiBold" Text="Material Cost"/>
                        <TextBlock FontSize="13"  Margin="0,0,5,5"
                                   FontWeight="SemiBold" Text="Labor Cost"/>
                        <TextBlock FontSize="13"  Margin="0,0,5,5"
                                   FontWeight="SemiBold" Text="Labor %"/>
                        <TextBlock FontSize="13"  Margin="0,0,5,5"
                                   FontWeight="SemiBold" Text="Total Cost"/>
                    </StackPanel>
                    <StackPanel Grid.Column="1">
                        <TextBlock FontSize="13" FontWeight="SemiBold"
                       Text="{Binding MetalCost}"
                       Margin="5,0,5,5"/>

                        <TextBlock FontSize="13" FontWeight="SemiBold"
                       Text="{Binding SlopeCost}"
                       Margin="5,0,5,5"/>

                        <TextBlock FontSize="13" FontWeight="SemiBold"
                       Text="{Binding SystemCost}"
                       Margin="5,0,5,5"/>

                        <TextBlock FontSize="13" FontWeight="SemiBold"
                       Text="{Binding MaterialCost}"
                       Margin="5,0,5,5"/>

                        <TextBlock FontSize="13" FontWeight="SemiBold"
                       Text="{Binding LaborCost}"
                       Margin="5,0,5,5"/>

                        <TextBlock FontSize="13" FontWeight="SemiBold"
                       Text="{Binding LaborPercentage}"
                       Margin="5,0,5,5"/>

                        <TextBlock FontSize="14" FontWeight="Bold" Background="#FFE7BA0A"
                       Text="{Binding TotalCost}"
                       Margin="5,0,5,5"/>
                    </StackPanel>
                    
                </Grid>
            </GroupBox>
            
            <TextBlock Text="{Binding ProductVersion}" Margin="5"
                       HorizontalAlignment="Right"
                       VerticalAlignment="Bottom"/>
        </StackPanel>
    </Grid>
</UserControl>
